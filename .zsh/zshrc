#!/usr/bin/zsh
ZSHCFG="$HOME/.zsh"
ZSH="$ZSHCFG/oh-my-zsh"
ZSH_CUSTOM="$ZSHCFG"
plugins=(archlinux docker compleat git github ssh-agent gpg-agent nvm tmux fzf)
setopt completealiases

_has() {
  return $(whence $1 >/dev/null)
}

# Disable annoying auto-correct.
if [[ -f $ZSHCFG/zsh_nocomp ]]; then
    while read -r COMMAND; do
        alias $COMMAND="nocorrect $COMMAND"
    done < "$ZSHCFG/zsh_nocomp"
fi

[[ -f $ZSHCFG/aliases ]] && source $ZSHCFG/aliases # Aliases.
[[ -f "$HOME/.xresources.d/dircolors" ]] && eval $(dircolors $HOME/.xresources.d/dircolors) # Colors.

DISABLE_AUTO_TITLE=true
if [ $EUID -eq 0 ]; then
   ZSH_DISABLE_COMPFIX="true"
fi
source "$ZSHCFG/zsh_theme"

# FZF.
if _has fzf && _has ag; then
  export FZF_DEFAULT_COMMAND='ag --nocolor -g ""'
  export FZF_BASE=$(dirname $(which fzf))
  # export FZF_CTRL_T_COMMAND="find $HOME -type d 2>/dev/null"
  # export FZF_ALT_C_COMMAND="find $HOME -type d 2>/dev/null"
  export FZF_DEFAULT_OPTS='--height 30% --layout=reverse --border'
fi

# PATH
if [ ! -v PATHFIX ]; then
    export PATH=$PATH:~/.cargo/bin:~/.gem/ruby/2.5.0/bin
    # Avoid re-appending to path.
    export PATHFIX=1
fi

# Not quite ready yet.
# export WORKSPACES=$HOME/Source:$HOME/Work
# source "$ZSHCFG/workon/workon"

# use nvim if available.
if command -v nvim &>/dev/null; then
    export EDITOR=nvim
    alias vim='nvim'
else
    export EDITOR=vim
fi

# Other exports.
export GOPATH="$HOME/Source/go"
export LANG="en_CA.UTF-8"
export LC_ALL="en_CA.UTF-8"
export TERM=xterm-256color

stty -ixon # stop C-Q, C-S from freezing terminal.
